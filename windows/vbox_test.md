# 環境動作テスト
これまでに準備したVirtualBoxによるVM環境を実際のカチャカに接続して正しく動作することを確認します．

## カチャカとPCの接続
カチャカとPCをLANケーブルで接続します．カチャカ側は水色のルータの空いているLANポートに，PC側はご自身のパソコンのLANポートにケーブルを接続しましょう．

↓カチャカに搭載している水色のルータ<br>
<img src="/imgs/vb_test0.png" width=50%>

## 接続先IPアドレスの確認
接続先のカチャカのIPアドレス設定を確認します．以下のコマンドを入力してエディタで設定ファイルを開きます．

```bash
gedit ~/.bashrc
```

このコマンドを実行すると以下のようにエディタと共に，設定ファイル `.bashrc`が開きます．

<img src="/imgs/vb_test1.png" width=70%>

下までスクロールして以下の部分のIPアドレスを確認します．

```bash
export KACHAKA_IP=192.168.8.13
```

このIPアドレスが接続先のカチャカのIPアドレスとなります．必要に応じて適切なアドレスに設定してください．本講義で用いる場合は周りの人に聞きましょう．カチャカの IP アドレスはカチャカに記載されている青色の番号に対応しています。

|カチャカ番号|IPアドレス|
|:---:|:---:|
|1|192.168.8.11|
|2|192.168.8.12|
|無印|192.168.8.13|

IPアドレスを修正したら， `保存`ボタンを押下して保存し，エディタを終了します．以下のコマンドを入力して設定を反映します．

```bash
source ~/.bashrc
```

## pingで接続を確認する
パソコンとカチャカを接続したら以下のコマンドでパソコンとカチャカが正しく通信できることを確認します．

```bash
ping $KACHAKA_IP
```

これを実行すると以下のように何秒で相手から応答があったかが示されます．時間が示されていない場合は正しく通信ができていませんので接続先のIPアドレスやVirtualBoxのネットワークインタフェースの設定を確認してください．

<img src="/imgs/vb_test2.png" widt=50%>

## Rvizでカチャカの情報を表示してみる
Rvizと呼ばれる様々な情報を可視化することのできるツールを用いてカチャカのセンサが捉えている情報などを表示してみましょう．

パソコンとカチャカが接続されていることを確認して，ターミナルで以下のコマンドを入力します．

```bash
ros2 launch erasers_kachaka_bringup bringup.launch.py bringup_type:=0 use_rviz:=True
```

このコマンドを実行すると以下のような可視化ツールが起動します．

<img src="/imgs/vb_test3.png" width=50%>

しばらく待つとカチャカから情報が送られてきて，図のようなLRFの情報が表示されるようになります．

ここまでできればカチャカの開発準備は完了です．いよいよチュートリアルに進みましょう．

----
- [Virtual Boxで仮想マシンをセットアップするに戻る](/windows/vbox.md)