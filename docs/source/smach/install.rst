###########################
smach をインストールする
###########################

=========================
smach をインストールする
=========================

　パッケージ ``smach`` は ROS2 で標準的に利用できる状態遷移管理パッケージです．

.. caution::

    本ドキュメントではチュートリアル形式で進捗を進めます．以下のタブ「すぐにインストールする方法」を選んだ場合今後の解説に一部相違が生じることがありますが，
    ``smach`` 自体の解説は統一されていますので気をつけてください．

.. tabs::
    .. tab:: rosdep を使う

        ここでは前回学んだスキルを活かして smach パッケージをインストールしてみましょう．

        前回，パッケージ ``ros2_workshop`` を作成しました．ここではこのパッケージに smach を利用したノードを今後作成する予定なので，ros2_workshop パッケージが smach に依存するように ``package.xml`` に依存関係を追加しましょう．

        以下のコマンドを実行して，smach という名前を持つパッケージをインストール可能か調べましょう．

        .. code:: bash

            rosdep db | grep smach

        .. important::

            もし，rosdep を１ヶ月以上触れていない場合は，上記コマンドを実行する前に以下のコマンドを実行して rosdep を更新すべきです．

            .. code:: bash

                rosdep update

        実行結果を見ると，``smach`` という名前を持つパッケージが複数表示され，どれをインストールすべきか迷うかもしれません．
        おそらく上位に表示されるパッケージ ``smach`` を依存関係に追加すべきと考えるでしょうが，正解は ``smach_ros`` です．

        .. code:: bash

            $ rosdep db | grep smach
            executive_smach -> ros-humble-executive-smach
            smach -> ros-humble-smach
            smach_msgs -> ros-humble-smach-msgs
            smach_ros -> ros-humble-smach-ros # <--- これを追記する

        .. tip::
            
            開発しているパッケージに依存させたいパッケージを rosdep から探すとき，よく ``XXX`` （依存させたいパッケージ名）と ``XXX_ros`` という２つのパッケージが表示されることがあります．
            ここで推奨すべきパッケージは ``XXX_ros`` です．というのもほとんどの ``_ros`` が末尾についたパッケージは ``XXX`` をラップしていることが多く，そのパッケージを ROS2 の資源として利用できるように用意されていることがほとんどです．
            あなたが探しているパッケージに ``_ros`` があった場合，これをあなたが開発しているパッケージに依存するように記述すると依存関係解決が容易になります．

        ``ros2_workshop`` の ``package.xml`` に以下のようにパッケージ ``smach_ros`` が依存するように ``<package>`` タグ内に追記してください．

        .. code:: xml

            ...
            <depend>smach_ros</depend>
            ...

        完了したら，パッケージ直下で以下のコマンドを実行して依存関係を解決させましょう．このように依存関係を持つパッケージ直下でかつ ``--from-path`` にカレントディレクトリを指定することで今作業しているパッケージのみ依存関係を解決してくれます．

        .. code:: bash

            rosdep install -y -i --from-path .

        プロセスが終了したら以下のコマンドを実行してパッケージ ``smach_ros`` がインストールされたかどうか確認しましょう．応答があれば成功です．

        .. code:: bash

            ros2 pkg list | grep smach_ros

    .. tab:: すぐにインストールする

        すぐに smach をインストールしたい場合はターミナルで以下のコマンドを実行してください．

        .. code:: bash

            sudo apt update && sudo apt install -y ros-humble-smach-ros

        .. hint::

            もし，別のディストロの ROS2 を使用している場合は上記コマンドの ``humble`` をあなたが利用している ROS2 のディストロ名に書き換えるか，
            環境変数 ``$ROS_DISTRO`` に置換してください．

次に smach を使い基礎的な状態遷移(ステートマシーン)を組む方法を解説します．
