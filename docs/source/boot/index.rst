################################
ROS2 ワークスペースを用意する
################################

****************************************
ROS2 用 Docker コンテナを起動する
****************************************

　ターミナル上で手順「 :ref:`ROS2 運用用ワークスペースを用意する <setup-workspace-section>` 」でクローンしたディレクトリ ``ros2_guidance_ws`` に移動してください．

.. code:: bash

    cd ros2_guidance_ws

**以降は利用する OS によって作業手順が変わります．**

.. tabs::
    .. tab:: Linux (Ubuntu)

        　つぎに以下のコマンドを実行して Docker コンテナがローカルのディスプレイにアクセスできるようにします．これを行うことで Docker コンテナ内の GUI にアクセスすることができるようになります．

        .. code:: bash

            xhost +

        　そして以下のコマンドを実行してコンテナを起動します．

        .. code:: bash

            docker compose up linux
    
    .. tab:: macOS

        .. caution::

            以下の作業を行う前にお使いの Mac に **XQuartz** をインストールしてください．

        　つぎに以下のコマンドを実行して **XQuartz**  を起動してください．これを起動することで Docker コンテナ内の GUI にアクセスすることができるようになります．

        .. code:: bash

            open -a XQuartz

        　次に Docker Desktop を起動するため，ターミナルにて以下のコマンドを実行してください．

        .. code:: bash

            open -a docker

        　そして以下のコマンドを実行してコンテナを起動します．

        .. code:: bash

            docker compose up linux

　起動に成功すると以下のようなターミナルウィンドウ **「Terminator」** が表示されます．

.. image:: /_static/container_terminator.png

　これで Docker コンテナ上で ROS2 環境にアクセスし，利用する準備が整いました．

******************************
ros2_guidance_ws の操作方法
******************************
　本ドキュメントで利用する Docker コンテナの操作方法，利用方法を解説します．

コンテナを起動，停止
======================

　コンテナの起動，停止に関する操作方法を解説します．

コンテナを起動する
--------------------

　ローカルのターミナルで以下のコマンドを実行してコンテナを起動します．

.. code:: bash

    # Linux
    docker compose up linux

    # macOS
    docker compose up mac

起動ログを隠してコンテナを起動する
-------------------------------------

　以下のコマンドのようにオプション ``-d`` を付与することで，起動ログがターミナルに表示されなくなります．ローカルのターミナルで別の作業を行いたい場合などに便利です．

.. code:: bash

    # Linux
    docker compose up -d linux

    # macOS
    docker compose up -d mac

コンテナを停止する
-------------------------------------

　起動ログが表示されているターミナルで「Control + C」をすることで起動しているコンテナを停止することができます．しかし起動ログを隠してコンテナを起動した場合は以下のコマンドをを実行してください．

.. code:: bash

    # Linux
    docker compose stop linux

    # macOS
    docker compose stop mac

.. danger::

    　コンテナを停止するコマンドとしてもう一つ ``docker compose down`` がありますが，**このコマンドを実行するとコンテナ上で行った変更が全て失われます．** しかし ``src`` ディレクトリ内にあるファイルは残存します．

    　例えば ROS2 コンテナ上で何らかのパッケージを apt からインストールしたり，作成したパッケージ，ダウンロードしたパッケージをビルドしたあとに ``docker compose down`` を実行してしまうと
    コンテナ上で行われた作業がすべて失われ，再度同様の作業を行わなければならなくなります．

Terminator の操作方法
=========================

ウィンドウの最大化
---------------------

ショートカットキー「Win + ↑」

横分割
---------------------

ショートカットキー「Control + Shft + O」

縦分割
---------------------

ショートカットキー「Control + Shft + E」

タブを開く
---------------------

ショートカットキー「Control + Shft + T」

*********************************************
ローカルのワークスペースの利用準備をする
*********************************************

　ローカル環境で利用する場合は以下のコマンドを実行して事前にワークスペースの source を読み込むようにしておくと良いです．ビルドを行わない間警告が表示されることがありますが無視して構いません．

.. code:: bash

    echo ". ~/colcon_ws/install/setup.bash" >> ~/.bashrc
